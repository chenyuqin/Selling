<div id="update_customer_form" style="display: none;">
    <div class="weui_cells weui_cells_access">
        <div class="weui_cell">
            <div class="weui_cell_hd weui_cell_primary">姓名</div>
            <div class="weui_cell_bd">
                <input id="customer_name_new" class="weui_input" type="text" disabled="disabled"/>
            </div>
        </div>
        <div class="weui_cell">
            <div class="weui_cell_hd weui_cell_primary">手机</div>
            <div class="weui_cell_bd ">
                <input id="customer_phone_new" class="weui_input" type="tel" pattern="1[0-9]{10}"/>
            </div>
        </div>
        <div class="weui_cell">
            <div class="weui_cell_hd weui_cell_primary">收货地址</div>
            <div class="weui_cell_bd">
                <input id="customer_address_new" class="weui_input" type="text"/>
            </div>
        </div>
    </div>
    <div class="weui_btn_area" style="text-align:center">
    	<button type="button" class="weui_btn weui_btn_mini weui_btn_warn"  style="width:30%" id="update_delete_btn">删除客户</button>
        <button type="button" class="weui_btn weui_btn_mini weui_btn_primary"  style="width:30%" id="update_confirm_btn">确认修改</button>
        <button type="button" class="weui_btn weui_btn_mini weui_btn_default"  style="width:30%" id="update_cancel_btn">返回</button>
    </div>  
</div>
<div class="weui_dialog_alert" id="dialog" style="display: none;">
	    <div class="weui_mask"></div>
	    <div class="weui_dialog">
	        <div class="weui_dialog_hd"><strong class="weui_dialog_title">消息</strong></div>
	        <div class="weui_dialog_bd"></div>
	        <div class="weui_dialog_ft">
	            <a href="javascript:;" class="weui_btn_dialog primary">确定</a>
	        </div>
	    </div>
</div>
<div class="weui_dialog_confirm" id="delete_dialog" style="display:none;">
    <div class="weui_mask"></div>
    <div class="weui_dialog">
        <div class="weui_dialog_hd"><strong class="weui_dialog_title">删除客户</strong></div>
        <div class="weui_dialog_bd" style="text-align:center;">真的要删除吗</div>
        <div class="weui_dialog_ft">
            <a href="javascript:;" class="weui_btn_dialog default">取消</a>
            <a href="javascript:;" class="weui_btn_dialog primary">确定</a>
        <iframe id="tmp_downloadhelper_iframe" style="display: none;"></iframe></div>
	</div>
</div>
<script>

    $("#update_confirm_btn").click(function () {
       

        var url = "${path.concat('/customer/modify/')}" + customerId;
        var name = $("#customer_name_new").val();
        var phone = $("#customer_phone_new").val();
        var address = $("#customer_address_new").val();
        
    
        if((typeof phone == "undefined" || phone == "")&&(typeof address == "undefined" || address == "")){
            $("#dialog").find(".weui_dialog_bd").html("手机号码和地址不能为空！");
    		$("#dialog").fadeIn();
    		$("#customer_phone_new").val(customer.phone.phone);
            $("#customer_address_new").val(customer.address.address);       
        }
        else if(typeof phone == "undefined" || phone == "") {
    		$("#dialog").find(".weui_dialog_bd").html("手机号码不能为空！");
    		$("#dialog").fadeIn();
    		$("#customer_phone_new").val(customer.phone.phone);     
    	}else if(typeof address == "undefined" || address == "") {
    		$("#dialog").find(".weui_dialog_bd").html("地址不能为空！");
    		$("#dialog").fadeIn();
            $("#customer_address_new").val(customer.address.address);       
    	}else if(!(/^1[3|4|5|7|8]\d{9}$/.test(phone))){ 
            $("#dialog").find(".weui_dialog_bd").html("手机号码有误，请重填！");
    		$("#dialog").fadeIn();
    		$("#customer_phone_new").val(customer.phone.phone);     
        } else{
            $.post(url, {customerId: customerId, name: name, phone: phone, address: address}, function (result) {
               if (result.responseCode == "RESPONSE_OK") {
                  var newCustomer = result.data;
                  var node = "<a class='weui_cell' onclick='updateCustomer(this)' id='" + newCustomer.customerId + "'><div class='weui_cell_bd weui_cell_primary'><p>" + name + "</p></div><div class='weui_cell_ft'>" + phone + "</div></a>";
                  $("#customer_list").append(node);
                  $("#" + customerId).remove();    
                  $("#update_customer_form").hide();
                  $("#customer_panel").fadeIn();  
                  $("#customer_name_new").val("");
                  $("#customer_phone_new").val("");
                  $("#customer_address_new").val("");
               }else{
                  $("#dialog").find(".weui_dialog_bd").html("您新填入的手机号已经有其他人正在使用，请检查是否输入错误！");
    		      $("#dialog").fadeIn();
               }
                  
            });
    	
    	}
       
       
    });
	
	$("#update_delete_btn").click(function(){
    	$("#delete_dialog").fadeIn();
    });

    $("#update_cancel_btn").click(function () {
        $("#update_customer_form").hide();
        $("#customer_panel").fadeIn();
    });
    
    
    var customerId;
    var customer;
    function updateCustomer(obj) {
        $("#update_customer_form").fadeIn();
        customerId = obj.id;
        
        var url = "${path.concat('/customer/" + customerId + "')}";
        $.post(url, function (result) {
            customer = result.data;
			$("#customer_name_new").val(customer.name);
            $("#customer_phone_new").val(customer.phone.phone);
            $("#customer_address_new").val(customer.address.address);            
        });
        var url = "${path.concat('/customer/info/" + customerId + "')}";
        $.post(url, function (result) {
            if(result.responseCode != "RESPONSE_OK"){
            	return;
            }
            var lastOrder = result.data.lastOrder;
            var salesInfo = result.data.salesInfo;
        });
        
        $("#customer_panel").hide();
    }
    
    $("#dialog").find(".weui_btn_dialog.primary").click(function(){
    	$("#dialog").hide();
    });
    
    $("#delete_dialog").find(".weui_btn_dialog.default").click(function(){
    	$("#delete_dialog").hide();
    });
    
    $("#delete_dialog").find(".weui_btn_dialog.primary").click(function(){
    	var url = "${path.concat('/customer/delete/')}" + customerId;
    	$.post(url,{},function(result){
    		$("#" + customerId).remove();
    		$("#delete_dialog").hide();
    		$("#update_customer_form").hide();
    		$("#customer_panel").fadeIn();
    	});
    });
</script>