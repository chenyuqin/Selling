<div class="ui stackable padded grid" name="log_area">
    <div class="row">
        <h1 class="ui header">
            <i class="home icon"></i>
            <div class="content">日志查询</div>
        </h1>
    </div>
    <div class="row">
        <div class="column">
            <div class="ui segment">
                #parse("/backend/common/datetimepicker.vm")
            </div>
        </div>
    </div>
    <div class="row">
        <div class="column" id="container">
            <div class="content">
                <div class="wrapper">
                    <hr class="line-left">
                    <hr class="line-right">
                    <div class="main-container">
                        <div class="main-content">
                            <h1 class="title">系统日志</h1>
                            <div class="year">
                                <h2><a href="#">2016年<i></i></a></h2>
                                <div class="list">
                                    <ul>
                                        #foreach( $log in ${logs} )
                                            <li class="cls">
                                                <p class="date">$!date.format('MM-dd HH:mm:ss ',$!{log.createAt})</p>
                                                <div class="intro">
                                                    <p class="event">${log.operationEvent}</p>
                                                    <div class="more">
                                                        <p class="account">账号：  ${log.adminInfo}</p>
                                                        #if(${log.ip})
                                                            <p class="ipInfo">ip地址：${log.ip}</p>
                                                        #end
                                                    </div>
                                                </div>
                                            </li>
                                        #end
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var pageStart=0;
    var pageLength=10;
    var years=new Array();
    $(document).ready(function () {
        $.ajax({
            type : 'POST',
            url : "${path.concat('/log/fetch')}",
            data : {
                start : pageStart,
                length : pageLength,
            },
            dataType : 'json',
            success : function(result) {
                var total = result.total;
                var data=result.data;
                var node="";
                if(data==null){
                    node+="<div class='ui center aligned segment'><h1>当前暂无操作日志</h1></div>";
                    $('#container').append(node);
                }else{
                    for(var i=0;i<data.length;i++){
                        var item=data[i];
                        var adminInfo=item.adminInfo;
                        var year=(new Date(item.createAt)).format("yyyy");
                        if(!$.inArray(year,years)){
                            years.push(year);
                        }
                        var createAt=(new Date(item.createAt)).format("yyyy/MM/dd hh:mm:ss");
                        var operationEvent=item.operationEvent;
                        node+="<div class='item'><i class='mail icon'></i><div class='content'><a class='header'>"+createAt+"/"+adminInfo+"</a><div class='description'>"+operationEvent+"</div></div></div>"
                    }
                    pageStart+=pageLength;
                    if(pageStart<total){
                        node+="<button class='ui right labeled icon button' id='load'><i class='right arrow icon'></i>加载更多</button>";
                    }
                    $('#logList').append(node);
                    $("#load").on('click',load);
                    
                }           
            }
        })
        var length=$('.cls').width()-$('.date').width();
        $('.intro').css('width',length-1);
    });

    $(".main .year .list").each(function (e, target) {
        var $target=  $(target);
        var $ul = $target.find("ul");
        $target.height($ul.outerHeight()), $ul.css("position", "absolute");
    });
    $(".main .year>h2>a").click(function (e) {
        e.preventDefault();
        $(this).parents(".year").toggleClass("log_close");
    });
</script>