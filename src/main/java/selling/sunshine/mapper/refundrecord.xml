<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="selling.refund.record">
	<resultMap id="refundRecordVo" type="selling.sunshine.model.RefundRecord">
		<result property="refundRecordId" column="refund_id"></result>
		<result property="refundName" column="refund_name"></result>
		<result property="refundPercent" column="refund_percent"></result>
		<result property="refundAmount" column="refund_amount"></result>
		<result property="refundDescription" column="refund_description"></result>
		<association property="agent" column="agentId = agent_id" select="agentLiteQuery"></association>
	</resultMap>
	
	  <resultMap id="agentLiteVo" type="selling.sunshine.model.lite.Agent">
        <result property="agentId" column="agent_id"></result>
        <result property="name" column="agent_name"></result>
        <result property="phone" column="agent_phone"></result>
    </resultMap>
	
    <insert id="insert" parameterType="selling.sunshine.model.RefundRecord"
		useGeneratedKeys="false">
		INSERT INTO refund_record
		<set>
		    refund_id=#{refundRecordId},
			<if test="orderPool != null and orderPool != ''">
				order_pool_id = #{orderPool.orderPoolId},
			</if>
			<if test="refundName != null and refundName != ''">
				refund_name = #{refundName},
			</if>
			<if test="refundDescription != null and refundDescription != ''">
				refund_description = #{refundDescription},
			</if>
			<if test="refundPercent != null and refundPercent != ''">
				refund_percent = #{refundPercent},
			</if>
			<if test="refundAmount != null and refundAmount != ''">
				refund_amount = #{refundAmount},
			</if>
			<if test="agent != null and agent != ''">
				agent_id = #{agent.agentId},
			</if>
			block_flag = #{blockFlag},
			create_time = #{createAt}
		</set>
    </insert>
    
   <select id="agentLiteQuery" parameterType="java.util.Map" resultMap="agentLiteVo">
		SELECT agent_id, agent_name, agent_phone
		FROM agent
		WHERE agent_id = #{agentId}
	</select>
	
	<select id="query" parameterType="java.util.Map" resultMap="refundRecordVo">
	    SELECT refund_id,refund_name,refund_percent,refund_amount,refund_description,agent_id
	    FROM refund_record
	    WHERE 1 = 1
        <if test="refundRecordId != null and refundRecordId != ''">
            AND refund_id = #{refundRecordId}
        </if>
        <if test="agentId != null and agentId != ''">
            AND agent_id = #{agentId}
        </if>
	</select>

	
</mapper>