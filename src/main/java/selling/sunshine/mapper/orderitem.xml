<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="selling.order.item">
    <resultMap id="goodsVo" type="selling.sunshine.model.Goods">
        <result property="goodsId" column="goods_id"></result>
        <result property="name" column="goods_name"></result>
        <result property="price" column="goods_price"></result>
        <result property="description" column="goods_description"></result>
        <result property="blockFlag" column="block_flag"></result>
        <result property="createAt" column="create_time"></result>
    </resultMap>

    <resultMap id="orderVo" type="selling.sunshine.model.Order">
        <result property="orderId" column="order_id"></result>
        <result property="blockFlag" column="block_flag"></result>
        <result property="createAt" column="create_time"></result>
    </resultMap>

    <resultMap id="customerVo" type="selling.sunshine.model.Customer">
        <result property="customerId" column="customer_id"></result>
        <result property="name" column="customer_name"></result>
        <result property="blockFlag" column="block_flag"></result>
        <result property="createAt" column="create_time"></result>
    </resultMap>

    <resultMap id="orderItemVo" type="selling.sunshine.model.OrderItem">
        <result property="orderItemId" column="order_item_id"></result>
        <result property="status" column="order_item_status"
                typeHandler="selling.sunshine.handler.mybatis.OrderItemStatusHandler"></result>
        <result property="goodsQuantity" column="goods_quantity"></result>
        <result property="orderItemPrice" column="order_item_price"></result>
        <result property="blockFlag" column="block_flag"></result>
        <result property="createAt" column="create_time"></result>
        <association property="customer" column="customerId = customer_id" select="customerQuery"></association>
        <association property="goods" column="goodsId = goods_id" select="goodsQuery"></association>
        <association property="order" column="orderId = order_id" select="orderQuery"></association>
    </resultMap>

    <insert id="insertBatch" parameterType="java.util.List" useGeneratedKeys="false">
        INSERT INTO order_item(order_item_id, order_item_status, order_id, customer_id, goods_id, goods_quantity,
        order_item_price,
        block_flag, create_time)
        VALUES
        <foreach collection="list" item="element" index="index" separator=",">
            (#{element.orderItemId}, #{element.status, typeHandler=org.apache.ibatis.type.EnumOrdinalTypeHandler},
            #{element.order.orderId},
            #{element.customer.customerId},#{element.goods.goodsId},#{element.goodsQuantity},#{element.orderItemPrice},#{element.blockFlag},
            #{element.createAt})
        </foreach>
    </insert>

    <select id="goodsQuery" parameterType="java.util.Map" resultMap="goodsVo">
         SELECT goods_id, goods_name, goods_price, goods_description, block_flag, create_time
         FROM goods
         WHERE goods_id = #{goodsId}
    </select>

    <select id="orderQuery" parameterType="java.util.Map" resultMap="orderVo">
        SELECT order_id, agent_id, block_flag, create_time
        FROM `order`
        WHERE order_id = #{orderId}
    </select>

    <select id="customerQuery" parameterType="java.util.Map" resultMap="customerVo">
        SELECT customer_id, customer_name, agent_id, block_flag, create_time
        FROM customer
        WHERE customer_id = #{customerId}
    </select>

</mapper>